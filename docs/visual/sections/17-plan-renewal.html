<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KINETIX - Plan Renewal Flow</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #0A0A0A 0%, #1E1E1E 100%);
            color: #FFFFFF;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 20px;
            line-height: 1.8;
            font-size: 16px;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px;
            background: rgba(157, 78, 221, 0.1);
            border: 2px solid #9D4EDD;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(157, 78, 221, 0.3);
        }
        
        h1 {
            font-size: 3.5em;
            color: #9D4EDD;
            text-shadow: 0 0 20px rgba(157, 78, 221, 0.8);
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .subtitle {
            color: #B3B3B3;
            font-size: 1.3em;
            margin-bottom: 30px;
        }
        
        .summary-card, .example-card, .explanation-card {
            margin-bottom: 25px;
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid;
        }
        
        .summary-card {
            background: rgba(157, 78, 221, 0.1);
            border-left-color: #9D4EDD;
        }
        
        .summary-card h3 {
            color: #9D4EDD;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        .example-card {
            background: rgba(255, 165, 0, 0.1);
            border-left-color: #FFA500;
        }
        
        .example-card h3 {
            color: #FFA500;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        .explanation-card {
            background: rgba(0, 255, 0, 0.1);
            border-left-color: #00FF00;
        }
        
        .explanation-card h3 {
            color: #00FF00;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        .summary-card p, .example-card p, .explanation-card p,
        .summary-card ul, .example-card ul, .explanation-card ul {
            color: #E0E0E0;
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 10px;
        }
        
        .summary-card code, .example-card code, .explanation-card code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            color: #9D4EDD;
            font-family: 'Courier New', monospace;
        }
        
        .diagram-container {
            margin: 30px 0;
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 12px;
            border: 1px solid rgba(157, 78, 221, 0.2);
            overflow-x: auto;
            width: 100%;
        }
        
        .mermaid {
            background: transparent;
            width: 100%;
        }
        
        .version-badge {
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
            margin-left: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .version-badge.v2 {
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.25), rgba(0, 200, 0, 0.15));
            color: #00FF00;
            border: 2px solid #00FF00;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }
        
        .version-badge.v3 {
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.25), rgba(200, 130, 0, 0.15));
            color: #FFA500;
            border: 2px solid #FFA500;
            text-shadow: 0 0 10px rgba(255, 165, 0, 0.5);
        }
        
        .version-badge.v4 {
            background: linear-gradient(135deg, rgba(0, 191, 255, 0.25), rgba(0, 150, 200, 0.15));
            color: #00BFFF;
            border: 2px solid #00BFFF;
            text-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
        }
        
        .update-notice {
            background: linear-gradient(135deg, rgba(255, 0, 60, 0.2) 0%, rgba(200, 0, 40, 0.15) 100%);
            border: 2px solid #FF003C;
            border-radius: 12px;
            padding: 20px 25px;
            margin-bottom: 30px;
            box-shadow: 0 0 30px rgba(255, 0, 60, 0.3), 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .update-notice::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, #FF003C 0%, #CC0029 50%, #FF003C 100%);
            box-shadow: 0 0 20px rgba(255, 0, 60, 0.6);
        }
        
        .update-notice h3 {
            color: #FF003C;
            margin: 0 0 10px 0;
            font-size: 1.3em;
            font-weight: 700;
            text-shadow: 0 0 15px rgba(255, 0, 60, 0.5);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .update-notice p {
            color: #FFB3C1;
            margin: 0;
            font-size: 1em;
            line-height: 1.6;
        }
        
        .update-notice strong {
            color: #FFFFFF;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- UPDATE NOTICE -->
        <div class="update-notice">
            <h3><i class="fas fa-exclamation-triangle"></i> ⚠️ NEEDS TO BE UPDATED</h3>
            <p>
                <strong>Razlog:</strong> Ovde treba da bude unapređeni view kao <code>01-erd.html</code>. 
                Ne treba da bude identično, već <strong>malo bolji, detaljniji i lepši view</strong> sa modernim UI elementima, 
                animacijama i poboljšanim UX-om.
            </p>
        </div>
        
        <header>
            <h1>KINETIX</h1>
            <p class="subtitle">17. Plan Renewal Flow</p>
            <span class="version-badge v3">âš  V3</span>
        </header>
        
        <div class="section-content">
<div class="summary-card">
    <h3>📋 Šta je ovo?</h3>
    <p>
        <strong>Plan Renewal Flow (V3 - PLANIRANO)</strong> - Produžavanje plana za još 7 dana bez kreiranja novog plana.
        Ovo je V3 feature koji omogućava fleksibilno produžavanje postojećih planova.
    </p>
    <p>
        <strong>Status:</strong> 🟡 PLANIRANO (V3 Masterplan)
    </p>
    <p>
        <strong>Ključni pojmovi:</strong>
    </p>
    <ul>
        <li><code>POST /api/plans/:id/renew</code> - Endpoint za produžavanje plana</li>
        <li><code>planEndDate extension</code> - Produžava planEndDate za 7 dana</li>
        <li><code>New workout logs</code> - Generiše nove workout logs za narednu nedelju</li>
        <li><code>planHistory update</code> - Ažurira planHistory entry sa novim planEndDate</li>
    </ul>
</div>

<div class="example-card">
    <h3>💡 Primer iz prakse</h3>
    <p>
        <strong>Scenario:</strong> Trener Marko želi da produži plan klijenta Petra za još 7 dana bez kreiranja novog plana.
    </p>
    <p>
        <strong>Šta bi se dešavalo (kada se implementira):</strong>
    </p>
    <ol>
        <li>Trener poziva <code>POST /api/plans/:id/renew</code></li>
        <li>Backend pronalazi plan i proverava da li je aktivan</li>
        <li>Backend produžava planEndDate za 7 dana</li>
        <li>Backend generiše nove workout logs za narednu nedelju</li>
        <li>Backend ažurira planHistory entry sa novim planEndDate</li>
        <li>Klijent vidi produžene dane u kalendaru</li>
    </ol>
    <p>
        <strong>Rezultat:</strong> Plan je produžen za 7 dana bez potrebe za kreiranjem novog plana.
    </p>
</div>

<div class="mermaid">
sequenceDiagram
    participant Trainer as Trainer Dashboard
    participant API as Backend API
    participant PlansService as PlansService
    participant WorkoutService as WorkoutsService
    participant DB as MongoDB
    participant Client as Mobile App

    Note over Trainer,Client: V3 FEATURE: PLAN RENEWAL (PLANNED)

    Trainer->>API: POST /api/plans/:id/renew<br/>{extendByDays: 7}
    
    API->>PlansService: renewPlan(planId, extendByDays)
    
    PlansService->>DB: Find WeeklyPlan by ID
    DB-->>PlansService: Plan details
    
    PlansService->>PlansService: Validate plan is active<br/>(planEndDate >= today)
    
    alt Plan is active
        PlansService->>PlansService: Calculate new planEndDate:<br/>planEndDate += extendByDays (7 days)
        
        PlansService->>DB: Update WeeklyPlan:<br/>planEndDate = newPlanEndDate
        
        PlansService->>WorkoutService: Generate workout logs<br/>for next 7 days
        WorkoutService->>DB: Create WorkoutLog documents<br/>for new week
        
        PlansService->>DB: Find ClientProfiles with this plan<br/>in planHistory
        
        loop For each client with this plan
            PlansService->>DB: Update ClientProfile.planHistory:<br/>Find entry with planId,<br/>Update planEndDate = newPlanEndDate
        end
        
        PlansService-->>API: Plan renewed successfully
        API-->>Trainer: Success response
        
        Client->>API: GET /api/workouts/upcoming<br/>(refresh calendar)
        API-->>Client: Updated workout logs<br/>with new week
        
    else Plan is not active
        PlansService-->>API: Error: Plan is not active
        API-->>Trainer: Error message
    end

    Note over Trainer,Client: Result: Plan extended by 7 days,<br/>new workout logs generated,<br/>planHistory updated for all clients
</div>

<div class="explanation-card">
    <h3>🔍 Detaljno objašnjenje</h3>
    <p>
        <strong>Zašto je ovo važno?</strong> Plan Renewal omogućava trenerima da produže postojeće planove bez potrebe za kreiranjem novih planova. Ovo omogućava fleksibilnost i brže upravljanje.
    </p>
    <p>
        <strong>Kako bi radio Plan Renewal (kada se implementira):</strong>
    </p>
    <ul>
        <li><strong>Plan lookup:</strong> Sistem pronalazi plan po ID-u i proverava da li je aktivan</li>
        <li><strong>Date extension:</strong> planEndDate se produžava za 7 dana (ili custom broj dana)</li>
        <li><strong>Workout logs generation:</strong> Generišu se novi workout logs za narednu nedelju</li>
        <li><strong>planHistory update:</strong> Ažurira se planHistory entry za sve klijente koji imaju ovaj plan</li>
        <li><strong>Client refresh:</strong> Klijenti vide produžene dane u kalendaru</li>
    </ul>
    <p>
        <strong>V3 Masterplan:</strong> Ovo je feature 3.6 u V3 Masterplan-u. Implementiraće se kada se završi V2.
    </p>
</div>

        </div>
    </div>
    
    <script>
        let mermaidInitialized = false;
        
        // Initialize Mermaid
        function initMermaid() {
            if (mermaidInitialized) return;
            mermaid.initialize({ 
                startOnLoad: false,
                theme: 'dark',
                themeVariables: {
                    primaryColor: '#9D4EDD',
                    primaryTextColor: '#FFFFFF',
                    primaryBorderColor: '#9D4EDD',
                    lineColor: '#9D4EDD',
                    secondaryColor: '#1E1E1E',
                    tertiaryColor: '#0A0A0A',
                    background: '#1E1E1E',
                    mainBkg: '#1E1E1E',
                    secondBkg: '#0A0A0A',
                    textColor: '#FFFFFF',
                    actorBorder: '#9D4EDD',
                    actorBkg: '#1E1E1E',
                    actorTextColor: '#FFFFFF',
                    actorLineColor: '#9D4EDD',
                    signalColor: '#9D4EDD',
                    signalTextColor: '#FFFFFF',
                    labelBoxBkgColor: '#1E1E1E',
                    labelBoxBorderColor: '#9D4EDD',
                    labelTextColor: '#FFFFFF',
                    loopTextColor: '#FFFFFF',
                    noteBorderColor: '#9D4EDD',
                    noteBkgColor: '#1E1E1E',
                    noteTextColor: '#FFFFFF',
                    activationBorderColor: '#9D4EDD',
                    activationBkgColor: '#1E1E1E',
                    sequenceNumberColor: '#FFFFFF',
                    cScale0: '#9D4EDD',
                    cScale1: '#FF003C',
                    cScale2: '#FFA500'
                },
                flowchart: {
                    curve: 'basis',
                    padding: 40,
                    htmlLabels: true,
                    useMaxWidth: true
                },
                sequence: {
                    diagramMarginX: 80,
                    diagramMarginY: 20,
                    actorMargin: 50,
                    width: 150,
                    height: 65,
                    boxMargin: 10,
                    boxTextMargin: 5,
                    noteMargin: 10,
                    messageMargin: 50,
                    mirrorActors: true,
                    bottomMarginAdj: 1,
                    useMaxWidth: true,
                    rightAngles: false,
                    showSequenceNumbers: false
                },
                er: {
                    fontSize: 14
                }
            });
            mermaidInitialized = true;
        }
        
        // Render all Mermaid diagrams on page load
        window.addEventListener('DOMContentLoaded', () => {
            initMermaid();
            
            setTimeout(() => {
                document.querySelectorAll('.mermaid').forEach(async (element) => {
                    try {
                        const id = 'mermaid-' + Math.random().toString(36).substr(2, 9);
                        element.id = id;
                        await mermaid.run({ nodes: [element] });
                    } catch (error) {
                        console.error('Mermaid rendering error:', error);
                    }
                });
            }, 500);
        });
    </script>
</body>
</html>